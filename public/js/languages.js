// js/languages.js
const translations = {
  // 首页 firstindex.html
  'firstindex': {
    'market-overview': {
      'zh': '市场概览',
      'en': 'Market Overview'
    },
    'view-all': {
      'zh': '查看全部',
      'en': 'View All'
    },
    'community-insights': {
      'zh': '社区观点',
      'en': 'Community Insights'
    },
    'sector-performance': {
      'zh': '热门板块',
      'en': 'Sector Performance'
    },
    'tech': {
      'zh': '科技',
      'en': 'Technology'
    },
    'healthcare': {
      'zh': '医疗保健',
      'en': 'Healthcare'
    },
    'energy': {
      'zh': '能源',
      'en': 'Energy'
    }
  },
  
  // 详情页 index.html
  'index': {
    'market-center': {
      'zh': '行情中心',
      'en': 'Market Center'
    },
    'search': {
      'zh': '搜索股票',
      'en': 'Search Stocks'
    },
    'sort-by-change': {
      'zh': '按涨幅排序',
      'en': 'Sort by Change'
    },
    'sort-by-market-cap': {
      'zh': '按市值排序',
      'en': 'Sort by Market Cap'
    },
    'sort-by-name': {
      'zh': '按名称排序',
      'en': 'Sort by Name'
    },
    'id': {
      'zh': 'ID',
      'en': 'ID'
    },
    'name': {
      'zh': '名字',
      'en': 'Name'
    },
    'change': {
      'zh': '涨幅',
      'en': 'Change'
    },
    'volume': {
      'zh': '成交量',
      'en': 'Volume'
    },
    'pe-ratio': {
      'zh': '市盈率',
      'en': 'P/E Ratio'
    },
    'turnover-rate': {
      'zh': '换手率',
      'en': 'Turnover Rate'
    },
    'funds-inflow': {
      'zh': '资金流入',
      'en': 'Funds Inflow'
    },
    'high-52w': {
      'zh': '52周最高',
      'en': '52W High'
    },
    'pb-ratio': {
      'zh': '市净率',
      'en': 'P/B Ratio'
    },
    'funds-outflow': {
      'zh': '资金流出',
      'en': 'Funds Outflow'
    },
    'low-52w': {
      'zh': '52周最低',
      'en': '52W Low'
    },
    'buy': {
      'zh': '买入',
      'en': 'Buy'
    }
  },
  
  // 持仓页 positions.html
  'positions': {
    'portfolio': {
      'zh': '持仓',
      'en': 'Portfolio'
    },
    'total-assets': {
      'zh': '总资产',
      'en': 'Total Assets'
    },
    'daily-pnl': {
      'zh': '当日盈亏',
      'en': 'Daily P&L'
    },
    'holdings-count': {
      'zh': '持仓股票数',
      'en': 'Holdings'
    },
    'shanghai-index': {
      'zh': '上证指数',
      'en': 'Shanghai Index'
    },
    'portfolio-details': {
      'zh': '持仓详情',
      'en': 'Portfolio Details'
    },
    'search-placeholder': {
      'zh': '搜索股票代码或名称...',
      'en': 'Search by code or name...'
    },
    'view-all': {
      'zh': '全部',
      'en': 'All'
    },
    'profit': {
      'zh': '盈利',
      'en': 'Profit'
    },
    'loss': {
      'zh': '亏损',
      'en': 'Loss'
    },
    'stock-code': {
      'zh': '股票代码',
      'en': 'Code'
    },
    'stock-name': {
      'zh': '名称',
      'en': 'Name'
    },
    'quantity': {
      'zh': '持仓数量',
      'en': 'Quantity'
    },
    'cost-price': {
      'zh': '成本价',
      'en': 'Cost Price'
    },
    'current-price': {
      'zh': '当前价',
      'en': 'Current Price'
    },
    'pnl': {
      'zh': '盈亏',
      'en': 'P&L'
    },
    'action': {
      'zh': '操作',
      'en': 'Action'
    },
    'buy': {
      'zh': '买入',
      'en': 'Buy'
    },
    'sell': {
      'zh': '卖出',
      'en': 'Sell'
    },
    'history': {
      'zh': '查看历史交易记录',
      'en': 'View Transaction History'
    },
    'history-title': {
      'zh': '历史交易记录',
      'en': 'Transaction History'
    }
  },
  
  // 新闻页 news.html
  'news': {
    'news-title': {
      'zh': '股票市场新闻',
      'en': 'Stock Market News'
    },
    'market-analysis': {
      'zh': '市场分析',
      'en': 'Market Analysis'
    },
    'industry-news': {
      'zh': '行业动态',
      'en': 'Industry News'
    },
    'sector-analysis': {
      'zh': '板块分析',
      'en': 'Sector Analysis'
    },
    'fund-flows': {
      'zh': '资金流向',
      'en': 'Fund Flows'
    },
    'earnings': {
      'zh': '公司财报',
      'en': 'Earnings'
    },
    'macro': {
      'zh': '宏观政策',
      'en': 'Macro Policy'
    },
    'hk-market': {
      'zh': '港股动态',
      'en': 'HK Market'
    }
  },
  
  // 个人设置页 personal-settings.html
  'personal-settings': {
    'personal-settings': {
      'zh': '个人设置',
      'en': 'Personal Settings'
    },
    'full-name': {
      'zh': '姓名',
      'en': 'Full Name'
    },
    'nickname': {
      'zh': '昵称',
      'en': 'Nickname'
    },
    'email': {
      'zh': '邮箱',
      'en': 'Email'
    },
    'phone': {
      'zh': '手机号',
      'en': 'Phone'
    },
    'bio': {
      'zh': '个人简介',
      'en': 'Bio'
    },
    'avatar': {
      'zh': '头像',
      'en': 'Avatar'
    },
    'change-avatar': {
      'zh': '更换头像',
      'en': 'Change Avatar'
    },
    'save-settings': {
      'zh': '保存设置',
      'en': 'Save Settings'
    }
  },
  
  // 账户设置页 account-settings.html
  'account-settings': {
    'account-settings': {
      'zh': '账户信息',
      'en': 'Account Settings'
    },
    'account-details': {
      'zh': '账户详情',
      'en': 'Account Details'
    },
    'username': {
      'zh': '用户名',
      'en': 'Username'
    },
    'account-id': {
      'zh': '账户ID',
      'en': 'Account ID'
    },
    'register-date': {
      'zh': '注册时间',
      'en': 'Register Date'
    },
    'last-login': {
      'zh': '最后登录',
      'en': 'Last Login'
    },
    'security-settings': {
      'zh': '安全设置',
      'en': 'Security Settings'
    },
    'current-password': {
      'zh': '当前密码',
      'en': 'Current Password'
    },
    'new-password': {
      'zh': '新密码',
      'en': 'New Password'
    },
    'confirm-password': {
      'zh': '确认新密码',
      'en': 'Confirm New Password'
    },
    'change-password': {
      'zh': '修改密码',
      'en': 'Change Password'
    },
    'danger-zone': {
      'zh': '危险操作',
      'en': 'Danger Zone'
    },
    'delete-account': {
      'zh': '注销账户',
      'en': 'Delete Account'
    },
    'delete-warning': {
      'zh': '注销后将永久删除您的所有数据，此操作不可恢复',
      'en': 'Deleting your account will permanently remove all your data. This action cannot be undone.'
    }
  },
  
  // 登录页 login.html
  'login': {
    'login-title': {
      'zh': '登录您的账户',
      'en': 'Login to Your Account'
    },
    'login-prompt': {
      'zh': '输入您的凭证以访问交易系统',
      'en': 'Enter your credentials to access the trading system'
    },
    'username': {
      'zh': '用户名',
      'en': 'Username'
    },
    'password': {
      'zh': '密码',
      'en': 'Password'
    },
    'remember-me': {
      'zh': '记住我',
      'en': 'Remember Me'
    },
    'forgot-password': {
      'zh': '忘记密码？',
      'en': 'Forgot Password?'
    },
    'login': {
      'zh': '登录',
      'en': 'Login'
    },
    'no-account': {
      'zh': '还没有账户？',
      'en': 'No account yet?'
    },
    'register': {
      'zh': '立即注册',
      'en': 'Register Now'
    }
  },
  
  // 通用
  'common': {
    'home': {
      'zh': '首页',
      'en': 'Home'
    },
    'details': {
      'zh': '详情',
      'en': 'Details'
    },
    'portfolio': {
      'zh': '持仓',
      'en': 'Portfolio'
    },
    'news': {
      'zh': '新闻',
      'en': 'News'
    },
    'personal-settings': {
      'zh': '个人设置',
      'en': 'Personal Settings'
    },
    'account-info': {
      'zh': '账户信息',
      'en': 'Account Info'
    },
    'logout': {
      'zh': '退出登录',
      'en': 'Logout'
    },
    'search-placeholder': {
      'zh': '搜索股票...',
      'en': 'Search stocks...'
    },
    'search-placeholder-news': {
      'zh': '搜索股票、指数、加密货币...',
      'en': 'Search stocks, indices, crypto...'
    }
  }
};

// 语言管理器
class LanguageManager {
  constructor() {
    this.currentLanguage = localStorage.getItem('language') || 'zh';
    this.init();
  }
  
  init() {
    // 设置初始语言
    this.setLanguage(this.currentLanguage);
    
    // 绑定语言切换事件
    const languageToggle = document.getElementById('languageToggle');
    if (languageToggle) {
      languageToggle.addEventListener('click', () => {
        this.toggleLanguage();
      });
    }
  }
  
  toggleLanguage() {
    this.currentLanguage = this.currentLanguage === 'zh' ? 'en' : 'zh';
    localStorage.setItem('language', this.currentLanguage);
    this.setLanguage(this.currentLanguage);
    this.updateLanguageText();
  }
  
  setLanguage(lang) {
    this.currentLanguage = lang;
    this.translatePage();
  }
  
  updateLanguageText() {
    const languageText = document.getElementById('languageText');
    if (languageText) {
      languageText.textContent = this.currentLanguage === 'zh' ? 'EN' : '中文';
    }
  }
  
  translatePage() {
    // 获取当前页面标识
    const pageId = this.getCurrentPageId();
    if (!pageId) return;
    
    // 翻译页面元素
    this.translateElements(pageId);
    this.updateLanguageText();
  }
  
  getCurrentPageId() {
    const path = window.location.pathname;
    if (path.includes('firstindex')) return 'firstindex';
    if (path.includes('index') && !path.includes('firstindex')) return 'index';
    if (path.includes('positions')) return 'positions';
    if (path.includes('news')) return 'news';
    if (path.includes('personal-settings')) return 'personal-settings';
    if (path.includes('account-settings')) return 'account-settings';
    if (path.includes('login')) return 'login';
    return null;
  }
  
  translateElements(pageId) {
    // 翻译导航栏通用元素
    this.translateElement('common-home', 'common', 'home');
    this.translateElement('common-details', 'common', 'details');
    this.translateElement('common-portfolio', 'common', 'portfolio');
    this.translateElement('common-news', 'common', 'news');
    this.translateElement('common-personal-settings', 'common', 'personal-settings');
    this.translateElement('common-account-info', 'common', 'account-info');
    this.translateElement('common-logout', 'common', 'logout');
    this.translateElement('common-search-placeholder', 'common', 'search-placeholder');
    this.translateElement('common-search-placeholder-news', 'common', 'search-placeholder-news');
    
    // 根据页面翻译特定元素
    const pageTranslations = translations[pageId];
    if (pageTranslations) {
      for (const [key, value] of Object.entries(pageTranslations)) {
        this.translateElement(key, pageId, key);
      }
    }
  }
  
  translateElement(elementId, page, key) {
    const element = document.getElementById(elementId) || 
                   document.querySelector(`[data-i18n="${page}-${key}"]`) ||
                   document.querySelector(`.${page}-${key}`);
    
    if (element && translations[page] && translations[page][key]) {
      const translation = translations[page][key][this.currentLanguage];
      if (translation) {
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
          element.placeholder = translation;
        } else {
          element.textContent = translation;
        }
      }
    }
  }
}

// 初始化语言管理器
document.addEventListener('DOMContentLoaded', function() {
  window.languageManager = new LanguageManager();
});